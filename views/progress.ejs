<!DOCTYPE html>
<html lang="en">
<head>
  <%-include("partials/header.ejs")%>
  <link rel="stylesheet" href="/css/progress.css">
</head>
<body>
  <%- include('partials/nav') %>

  <div class="container mt-5">
    <h1 class="mb-4">Task Progress</h1>
    <table class="table table-dark table-striped">
      <thead>
        <tr>
          <th scope="col">Task ID</th>
          <th scope="col">Topic</th>
          <th scope="col">Side</th>
          <th scope="col">Argument</th>
          <th scope="col">Progress</th>
        </tr>
      </thead>

      <%tasks.forEach((task, index) => { if(task.status=="processing") { %>
        <tbody class="task-row">
          <tr data-bs-toggle="collapse" data-bs-target="#collapse<%= task.id %>" aria-expanded="false" aria-controls="collapse<%= task.id %>" class="accordion-toggle">
            <td><%= task.id %></td>
            <td><%= task.topic %></td>
            <td><%= task.side %></td>
            <td><%= task.argument %></td>
            <td>
              <div class="progress">
                <div class="progress-bar" role="progressbar" style="width: <%= task.progress.progress_as_num * 100 %>%" aria-valuenow="<%= task.progress.progress_as_num * 100 %>" aria-valuemin="0" aria-valuemax="100"><%= (task.progress.progress_as_num * 100).toFixed(0) %>%</div>
              </div>              
            </td>
          </tr>
      
          <tr>
            <td colspan="5" class="hiddenRow">
              <div id="collapse<%= task.id %>" class="accordion-body collapse">
                <p><strong>Task ID:</strong> <%= task.id %></p>
                <p><strong>Topic:</strong> <%= task.topic %></p>
                <p><strong>Side:</strong> <%= task.side %></p>
                <p><strong>Argument:</strong> <%= task.argument %></p>
                <p><strong>Stage:</strong> <%= task.progress.stage %></p>
                <p><strong>Progress:</strong> <%= task.progress.progress_as_string %></p>
              </div>
            </td>
          </tr>
        </tbody>
      <% } else if (task.status == "complete") { %>
        <tbody class="task-row">
          <tr data-bs-toggle="collapse" data-bs-target="#collapse<%= task.id %>" aria-expanded="false" aria-controls="collapse<%= task.id %>" class="accordion-toggle">
            <td><%= task.id %></td>
            <td><%= task.topic %></td>
            <td><%= task.side %></td>
            <td><%= task.argument %></td>
            <td style="color: green">
                Completed! <i class="fa fa-check" aria-hidden="true"></i>             
            </td>
          </tr>
      
          <tr>
            <td colspan="5" class="hiddenRow">
              <div id="collapse<%= task.id %>" class="accordion-body collapse">
                <a href="/evidence/<%=user.id%>/<%= task.id %>">View Evidence</a>
              </div>
            </td>
          </tr>
        </tbody>
     <% }}) %>      
      
      
      
    </table>
  </div>
  <%- include("partials/footer")%>
  <script src="/js/progress.js"></script>
</body>
</html>